---
title: Terraformのkmsリソースによるシークレット情報の取り扱い
emoji: 🔒
type: tech
topics: [Terraform, gcp, CICD, AWS]
published: false
---

# 要約
Terraformでシークレット情報をkmsリソースを使い取り扱う方法について。
実行方法は以下の通りです。

1. 各種サービスでKMSでの鍵の作成
1. 鍵で秘匿したい情報の暗号化
1. 暗号化した情報のbase64でのエンコード
1. dataブロックを使い鍵情報の復号化
1. 各種リソースから復号したデータの呼び出し

# 背景
Terraformを使いインフラを構築するにあたり、秘匿情報を取り扱う必要が出てきます。
例えば、VPNを構築するにあたりShared シークレットをVPNトンネルを作成するにあたりTerraformコードに渡す必要があります。
これら秘匿情報の管理方法には色々な方法がありますが、今回はKMSを使った情報の管理方法について説明します。

# KMSについて
パブリッククラウドサービスは暗号鍵を管理するサービスKMSを提供しています。
AWS、GCPともにKMSというサービス名で提供しています。  
当該サービスは共通鍵と公開鍵の両方を提供しており、鍵自体もクラウドサービスが管理しています。
暗号・復号ともにクラウドが提供しているAPIを使い実施することができるため、
ユーザーが鍵を持つ必要がないため、鍵の漏洩問題はありません。   

しかしながら、鍵へのアクセス権限を間違ってしまうと、
暗号化した情報の復号が可能となってしまうので情報漏洩になるので、適切に権限管理をしてください。

## KMSを使ったデータの暗号化
ここでは、データを使った鍵の暗号化を説明します。鍵は共通鍵方式を使います。

### AWSでのデータの暗号化

### GCPでのデータの暗号化

# Terraformでの暗号化データの取り扱い
暗号化したデータをdataブロックに記述し、Terrafom内部で復号化処理をし
dataブロックを参照し復号したデータを取り出すことになります。

## AWSでのデータの取り扱い
    
## GCPでのデータの取り扱い

# まとめ

